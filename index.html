<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>One-Tap Study (SRS)</title>
  <style>
    body { font-family: system-ui, sans-serif; background:#0b1220; color:#e5e7eb; text-align:center; padding:20px; }
    h1 { font-size:18px; margin:0 0 12px; }
    .card { margin:16px auto; padding:36px; background:#0f172a; border:1px solid #1f2937; border-radius:14px; max-width:820px; min-height:30vh; font-size:clamp(22px,5vw,40px); display:flex; align-items:center; justify-content:center; }
    .controls { margin-top:10px; display:flex; gap:10px; justify-content:center; flex-wrap:wrap; }
    button { margin:6px; padding:12px 18px; border:none; border-radius:10px; font-size:16px; cursor:pointer; color:white; }
    .again { background:#ef4444; }
    .good { background:#06b6d4; }
    .easy { background:#10b981; }
    .hint { color:#9aa4b2; font-size:12px; margin-top:8px; }
  </style>
</head>
<body>
  <h1>ðŸ“š One-Tap Study (SRS) <span id="status">(loadingâ€¦)</span></h1>

  <div class="card" id="card">Loadingâ€¦</div>
  <div class="controls">
    <button class="again" onclick="grade('again')">Again</button>
    <button class="good" onclick="grade('good')">Good</button>
    <button class="easy" onclick="grade('easy')">Easy</button>
  </div>

  <script>
    let queue = [], idx = 0, apiUrl = null;
    const cardEl = document.getElementById('card');
    const statusEl = document.getElementById('status');

    function show(){
      const item = queue[idx];
      cardEl.textContent = item ? item.front : 'No cards due right now';
    }

    async function grade(type){
      if (!queue[idx]) return;
      const card = queue[idx];
      try {
        await fetch(apiUrl + '?grade=' + type + '&id=' + encodeURIComponent(card.id));
      } catch(e){ console.error(e); }
      queue.splice(idx,1);
      if (idx>=queue.length) idx = queue.length-1;
      if (idx<0) idx=0;
      show();
    }

    async function loadDue(){
      if (!apiUrl) { cardEl.textContent='Missing ?api=â€¦ in URL'; return; }
      try {
        const resp = await fetch(apiUrl+'?due=1',{cache:'no-store'});
        const data = await resp.json();
        queue = data.cards || [];
        idx=0; show();
        statusEl.textContent = 'âœ… Loaded ' + queue.length + ' cards';
      } catch(e){
        cardEl.textContent='Error: '+e.message;
        statusEl.textContent='âš ï¸ Load error';
      }
    }

    window.addEventListener('load',()=>{
      const p = new URLSearchParams(location.search);
      apiUrl = p.get('api');
      if (p.get('auto')) loadDue(); else cardEl.textContent='Ready.';
      if (p.get('kiosk')) document.querySelector('h1').style.display='none';
      statusEl.textContent='âœ… script loaded';
    });
  </script>
</body>
</html>